(()=>{var e={3:e=>{"use strict";e.exports=require("path")},156:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function i(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,i)}l((n=n.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.info=void 0,t.init=g,t.exit=b;const o=s(r(268)),a=r(895),i=r(790),l=r(162),c=r(958),d=new a.Chalk,u="[SillyTavern-ValueTracker-Plugin]";let h,f;function g(e){return n(this,void 0,void 0,function*(){const t=o.default.json();console.log(d.blue(u),"Initializing Value Tracker Plugin..."),h=new l.CrossExtensionReader,console.log(d.green(u),"CrossExtensionReader initialized"),f=new i.ApiEndpoints(h),console.log(d.green(u),"API endpoints initialized"),(0,c.setCrossExtensionReader)(h),console.log(d.green(u),"CrossExtensionReader set for other extensions"),e.use("/",f.getRouter()),console.log(d.green(u),"API routes registered"),e.get("/probe",(e,t)=>(console.log(d.blue(u),"Probe endpoint accessed from IP:",e.ip||e.socket.remoteAddress),t.sendStatus(204))),e.post("/ping",t,(e,t)=>n(this,void 0,void 0,function*(){try{console.log(d.blue(u),"Ping endpoint accessed from IP:",e.ip||e.socket.remoteAddress);const{message:r}=e.body;return console.log(d.blue(u),"Ping received with message:",r),t.json({message:`Pong! ${r}`})}catch(e){return console.error(d.red(u),"Ping request failed",e),t.status(500).send("Internal Server Error")}})),console.log(d.green(u),"Plugin loaded successfully!")})}function b(){return n(this,void 0,void 0,function*(){console.log(d.yellow(u),"Plugin exit started"),h&&(h.closeAll(),console.log(d.yellow(u),"All extension databases closed")),console.log(d.yellow(u),"Plugin exited successfully")})}t.info={id:"valuetracker",name:"Value Tracking Plugin",description:"A simple value tracking plugin for SillyTavern server with database support."};const m={init:g,exit:b,info:t.info};t.default=m},162:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CrossExtensionReader=void 0;const n=r(941),s=r(599),o=new(r(895).Chalk),a="[ValueTracker-CrossExtensionReader]";t.CrossExtensionReader=class{constructor(){this.extensionDatabases=new Map}registerExtensionDatabase(e,t){const r=(0,s.validateExtensionId)(e);if(console.log(o.blue(a),"Registering database for extension:",r),this.extensionDatabases.has(r)){const e=this.extensionDatabases.get(r);e&&(console.log(o.yellow(a),"Closing existing database for extension:",r),e.close())}this.extensionDatabases.set(r,t),console.log(o.green(a),"Database registered successfully for extension:",r)}registerExtensionDatabaseByPath(e){const t=(0,s.validateExtensionId)(e);if(this.extensionDatabases.has(t)){const e=this.extensionDatabases.get(t);e&&e.close()}const r=new n.DatabaseManager(void 0,t);this.extensionDatabases.set(t,r)}deregisterExtensionDatabase(e){const t=(0,s.validateExtensionId)(e);console.log(o.blue(a),"Deregistering database for extension:",t),this.extensionDatabases.get(t)?(this.extensionDatabases.delete(t),console.log(o.green(a),"Database deregistered successfully for extension:",t)):console.log(o.yellow(a),"Database not found for extension during deregistration:",t)}getDbManager(e){const t=(0,s.validateExtensionId)(e),r=this.extensionDatabases.get(t);return r?(console.log(o.blue(a),"Database manager retrieved for extension:",t),r):(console.log(o.yellow(a),"Database manager not found for extension:",t),null)}getFullCharacter(e,t){const r=(0,s.validateExtensionId)(e);console.log(o.blue(a),"Retrieving full character:",t,"from extension:",r);const n=this.getDbManager(r);if(!n)return console.warn(o.yellow(a),"Database not registered for extension:",r),null;const i=n.getFullCharacter(t);return i?console.log(o.blue(a),"Successfully retrieved full character:",t,"from extension:",r):console.log(o.yellow(a),"Character not found:",t,"in extension:",r),i}getFullInstance(e,t){const r=(0,s.validateExtensionId)(e),n=this.getDbManager(r);return n?n.getFullInstance(t):(console.warn(`[CrossExtensionReader] Database not registered for extension: ${r}`),null)}getInstanceData(e,t){const r=(0,s.validateExtensionId)(e),n=this.getDbManager(r);return n?n.getData(t):(console.warn(`[CrossExtensionReader] Database not registered for extension: ${r}`),{})}getDataValue(e,t,r){const n=(0,s.validateExtensionId)(e),o=this.getDbManager(n);if(o)return o.getDataValue(t,r);console.warn(`[CrossExtensionReader] Database not registered for extension: ${n}`)}getAllCharacters(e){const t=(0,s.validateExtensionId)(e),r=this.getDbManager(t);return r?r.getAllCharacters():(console.warn(`[CrossExtensionReader] Database not registered for extension: ${t}`),[])}getInstancesByCharacter(e,t){const r=(0,s.validateExtensionId)(e),n=this.getDbManager(r);return n?n.getInstancesByCharacter(t):(console.warn(`[CrossExtensionReader] Database not registered for extension: ${r}`),[])}closeAll(){if(console.log(o.yellow(a),"Closing all extension databases"),0===this.extensionDatabases.size)return void console.log(o.blue(a),"No extension databases to close");for(const[e,t]of this.extensionDatabases)try{console.log(o.yellow(a),"Closing database for extension:",e),t.close(),console.log(o.green(a),"Successfully closed database for extension:",e)}catch(t){console.error(o.red(a),"Error closing database for extension",e+":",t)}const e=this.extensionDatabases.size;this.extensionDatabases=new Map,console.log(o.green(a),"All extension databases closed successfully. Total:",e)}}},252:e=>{"use strict";e.exports=require("express")},268:e=>{"use strict";e.exports=require("body-parser")},383:e=>{"use strict";e.exports=require("fs")},599:(e,t)=>{"use strict";function r(e){if("string"!=typeof e)throw new Error("Extension ID must be a string, got "+typeof e);if(null==e)throw new Error("Extension ID cannot be undefined or null");if(!e)throw new Error("Extension ID cannot be empty");let t=e.replace(/\.\.\//g,"").replace(/\.\.\\/g,"");if(t=t.replace(/[<>:"/\\|?*]/g,"_"),t=t.substring(0,255),!t)throw new Error("Extension ID became empty after sanitization");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeExtensionId=r,t.validateExtensionId=function(e){if("string"!=typeof e)throw new Error("Extension ID must be a string, got "+typeof e);if(null==e)throw new Error("Extension ID cannot be undefined or null");const t=r(e),n=t.trim();if(n.length<1)throw new Error("Extension ID must be at least 1 character");if(/^\s*$/.test(t))throw new Error("Extension ID cannot be only whitespace");if(n.startsWith("."))throw new Error("Extension ID cannot start with a dot");return n},t.isValidId=function(e){return!!e&&/^[a-zA-Z0-9_-]+$/.test(e)},t.isValidString=function(e){return"string"==typeof e&&e.trim().length>0},t.isValidObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},t.isValidJsonString=function(e){if("string"!=typeof e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}},t.safeJsonParse=function(e){try{return JSON.parse(e)}catch(e){return null}},t.validateRequestBody=function(e,t){const r=[];for(const n of e)n in t&&void 0!==t[n]&&null!==t[n]||r.push(n);return{isValid:0===r.length,missingFields:r.length>0?r:void 0}}},749:e=>{"use strict";e.exports=require("crypto")},790:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiEndpoints=void 0;const s=n(r(252)),o=r(941),a=r(599),i=new(r(895).Chalk),l="[ValueTracker-ApiEndpoints]";t.ApiEndpoints=class{constructor(e){this.crossExtensionReader=e,this.router=s.default.Router(),console.log(i.green(l),"Initializing API endpoints..."),this.setupRoutes(),console.log(i.green(l),"API endpoints initialized successfully")}getExtensionIdFromHeader(e){return e.headers["x-extension-id"]||null}getRouter(){return this.router}setupRoutes(){console.log(i.blue(l),"Registering POST /register"),this.router.post("/register",this.registerExtension.bind(this)),console.log(i.blue(l),"Registering DELETE /register"),this.router.delete("/register",this.deregisterExtension.bind(this)),console.log(i.blue(l),"Registering GET /characters"),this.router.get("/characters",this.getAllCharacters.bind(this)),console.log(i.blue(l),"Registering GET /characters/:id"),this.router.get("/characters/:id",this.getCharacter.bind(this)),console.log(i.blue(l),"Registering POST /characters"),this.router.post("/characters",this.upsertCharacter.bind(this)),console.log(i.blue(l),"Registering DELETE /characters/:id"),this.router.delete("/characters/:id",this.deleteCharacter.bind(this)),console.log(i.blue(l),"Registering GET /instances"),this.router.get("/instances",this.getAllInstances.bind(this)),console.log(i.blue(l),"Registering GET /instances/:id"),this.router.get("/instances/:id",this.getInstance.bind(this)),console.log(i.blue(l),"Registering GET /characters/:characterId/instances"),this.router.get("/characters/:characterId/instances",this.getInstancesByCharacter.bind(this)),console.log(i.blue(l),"Registering POST /instances"),this.router.post("/instances",this.upsertInstance.bind(this)),console.log(i.blue(l),"Registering DELETE /instances/:id"),this.router.delete("/instances/:id",this.deleteInstance.bind(this)),console.log(i.blue(l),"Registering GET /instances/:id/data"),this.router.get("/instances/:id/data",this.getInstanceData.bind(this)),console.log(i.blue(l),"Registering GET /instances/:id/data/:key"),this.router.get("/instances/:id/data/:key",this.getInstanceDataKey.bind(this)),console.log(i.blue(l),"Registering POST /instances/:id/data"),this.router.post("/instances/:id/data",this.upsertInstanceData.bind(this)),console.log(i.blue(l),"Registering PUT /instances/:id/data"),this.router.put("/instances/:id/data",this.upsertInstanceData.bind(this)),console.log(i.blue(l),"Registering DELETE /instances/:id/data/:key"),this.router.delete("/instances/:id/data/:key",this.deleteInstanceDataKey.bind(this)),console.log(i.blue(l),"Registering DELETE /instances/:id/data"),this.router.delete("/instances/:id/data",this.clearInstanceData.bind(this)),console.log(i.blue(l),"Registering DELETE /characters/:characterId/instances"),this.router.delete("/characters/:characterId/instances",this.deleteAllInstancesForCharacter.bind(this)),console.log(i.blue(l),"Registering PUT /instances/:id/data/override"),this.router.put("/instances/:id/data/override",this.overrideInstanceData.bind(this)),console.log(i.blue(l),"Registering PUT /instances/:id/data/merge"),this.router.put("/instances/:id/data/merge",this.mergeInstanceData.bind(this)),console.log(i.blue(l),"Registering PUT /instances/:id/data/remove"),this.router.put("/instances/:id/data/remove",this.removeInstanceDataKeys.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/characters/:extensionId/:id"),this.router.get("/cross-extension/characters/:extensionId/:id",this.getCrossExtensionCharacter.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/instances/:extensionId/:id"),this.router.get("/cross-extension/instances/:extensionId/:id",this.getCrossExtensionInstance.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/instances/:extensionId/:id/data"),this.router.get("/cross-extension/instances/:extensionId/:id/data",this.getCrossExtensionInstanceData.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/instances/:extensionId/:id/data/:key"),this.router.get("/cross-extension/instances/:extensionId/:id/data/:key",this.getCrossExtensionInstanceDataKey.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/characters/:extensionId"),this.router.get("/cross-extension/characters/:extensionId",this.getCrossExtensionAllCharacters.bind(this)),console.log(i.blue(l),"Registering GET /cross-extension/characters/:extensionId/:characterId/instances"),this.router.get("/cross-extension/characters/:extensionId/:characterId/instances",this.getCrossExtensionInstancesByCharacter.bind(this)),console.log(i.green(l),"All routes registered successfully")}getAllCharacters(e,t){try{console.log(i.blue(l),"GET /characters called from IP:",e.ip||e.socket&&e.socket.remoteAddress);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"GET /characters failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});if(!(0,a.isValidId)(r))return console.log(i.yellow(l),"GET /characters failed: Invalid extension ID format:",r),void t.status(400).json({error:"Valid extension ID is required (alphanumeric, hyphens, underscores only)"});const n=this.crossExtensionReader.getDbManager(r);if(!n)return console.log(i.yellow(l),"GET /characters failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});const s=n.getAllCharacters();console.log(i.blue(l),"GET /characters successful for extension:",r,"Returning",s.length,"characters"),t.json(s)}catch(e){const r=e instanceof Error?e.message:"Unknown error";console.error(i.red(l),"GET /characters failed with error:",r),t.status(500).json({error:r})}}getCharacter(e,t){try{console.log(i.blue(l),"GET /characters/:id called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for character ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"GET /characters/:id failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return console.log(i.yellow(l),"GET /characters/:id failed: Invalid character ID format:",n),void t.status(400).json({error:"Valid character ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return console.log(i.yellow(l),"GET /characters/:id failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});const o=s.getFullCharacter(n);if(!o)return console.log(i.yellow(l),"GET /characters/:id failed: Character not found with ID:",e.params.id,"for extension:",r),void t.status(404).json({error:"Character not found"});console.log(i.blue(l),"GET /characters/:id successful for character ID:",e.params.id,"in extension:",r),t.json(o)}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"GET /characters/:id failed with error for character ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}upsertCharacter(e,t){var r,n;try{console.log(i.blue(l),"POST /characters called from IP:",e.ip||e.socket&&e.socket.remoteAddress);const s=this.getExtensionIdFromHeader(e);if(!s)return console.log(i.yellow(l),"POST /characters failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const o=(0,a.validateRequestBody)(["id"],e.body);if(!o.isValid)return console.log(i.yellow(l),"POST /characters failed: Missing required fields:",null===(r=o.missingFields)||void 0===r?void 0:r.join(", ")),void t.status(400).json({error:`Missing required fields: ${null===(n=o.missingFields)||void 0===n?void 0:n.join(", ")}`});const{id:c,name:d}=e.body;if(!(0,a.isValidId)(c))return console.log(i.yellow(l),"POST /characters failed: Invalid character ID format:",c),void t.status(400).json({error:"Valid character ID is required (alphanumeric, hyphens, underscores only)"});if(void 0!==d&&"string"!=typeof d)return console.log(i.yellow(l),"POST /characters failed: name must be a string"),void t.status(400).json({error:"name must be a string"});const u=this.crossExtensionReader.getDbManager(s);if(!u)return console.log(i.yellow(l),"POST /characters failed: Database not found for extension:",s),void t.status(404).json({error:`Database not found for extension: ${s}`});console.log(i.blue(l),"Upserting character with ID:",e.body.id,"in extension:",s);const h=u.upsertCharacter({id:e.body.id,name:d||void 0});console.log(i.green(l),"Character upserted successfully for ID:",e.body.id,"in extension:",s),t.json(h)}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"POST /characters failed with error for character ID:",e.body.id,"error:",n),t.status(500).json({error:n})}}deleteCharacter(e,t){try{console.log(i.blue(l),"DELETE /characters/:id called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for character ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"DELETE /characters/:id failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return console.log(i.yellow(l),"DELETE /characters/:id failed: Invalid character ID format:",n),void t.status(400).json({error:"Valid character ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return console.log(i.yellow(l),"DELETE /characters/:id failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});if(console.log(i.blue(l),"Attempting to delete character with ID:",e.params.id,"in extension:",r),!s.deleteCharacter(e.params.id))return console.log(i.yellow(l),"DELETE /characters/:id failed: Character not found with ID:",e.params.id,"in extension:",r),void t.status(404).json({error:"Character not found"});console.log(i.green(l),"Character deleted successfully for ID:",e.params.id,"in extension:",r),t.json({success:!0})}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"DELETE /characters/:id failed with error for character ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}getAllInstances(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});if(!(0,a.isValidId)(r))return void t.status(400).json({error:"Valid extension ID is required (alphanumeric, hyphens, underscores only)"});const{characterId:n}=e.query,s=this.crossExtensionReader.getDbManager(r);if(!s)return void t.status(404).json({error:`Database not found for extension: ${r}`});if("string"==typeof n&&(0,a.isValidId)(n)){const e=s.getInstancesByCharacter(n);t.json(e)}else t.status(400).json({error:"Valid characterId query parameter is required (alphanumeric, hyphens, underscores only)"})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getInstance(e,t){try{console.log(i.blue(l),"GET /instances/:id called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"GET /instances/:id failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return console.log(i.yellow(l),"GET /instances/:id failed: Invalid instance ID format:",n),void t.status(400).json({error:"Valid instance ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return console.log(i.yellow(l),"GET /instances/:id failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});console.log(i.blue(l),"Retrieving instance with ID:",e.params.id,"in extension:",r);const o=s.getFullInstance(e.params.id);if(!o)return console.log(i.yellow(l),"GET /instances/:id failed: Instance not found with ID:",e.params.id,"in extension:",r),void t.status(404).json({error:"Instance not found"});console.log(i.blue(l),"GET /instances/:id successful for instance ID:",e.params.id,"in extension:",r),t.json(o)}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"GET /instances/:id failed with error for instance ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}getInstancesByCharacter(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{characterId:n}=e.params;if(!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid character ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return void t.status(404).json({error:`Database not found for extension: ${r}`});const o=s.getInstancesByCharacter(n);t.json(o)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}upsertInstance(e,t){var r,n;try{console.log(i.blue(l),"POST /instances called from IP:",e.ip||e.socket&&e.socket.remoteAddress);const s=this.getExtensionIdFromHeader(e);if(!s)return console.log(i.yellow(l),"POST /instances failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const o=(0,a.validateRequestBody)(["id","characterId"],e.body);if(!o.isValid)return console.log(i.yellow(l),"POST /instances failed: Missing required fields:",null===(r=o.missingFields)||void 0===r?void 0:r.join(", ")),void t.status(400).json({error:`Missing required fields: ${null===(n=o.missingFields)||void 0===n?void 0:n.join(", ")}`});const{id:c,characterId:d,name:u}=e.body;if(!(0,a.isValidId)(c)||!(0,a.isValidId)(d))return console.log(i.yellow(l),"POST /instances failed: Invalid instance ID or character ID format"),void t.status(400).json({error:"Valid instance ID and character ID are required (alphanumeric, hyphens, underscores only)"});if(void 0!==u&&"string"!=typeof u)return console.log(i.yellow(l),"POST /instances failed: name must be a string"),void t.status(400).json({error:"name must be a string"});const h=this.crossExtensionReader.getDbManager(s);if(!h)return console.log(i.yellow(l),"POST /instances failed: Database not found for extension:",s),void t.status(404).json({error:`Database not found for extension: ${s}`});console.log(i.blue(l),"Upserting instance with ID:",e.body.id,"for character:",e.body.characterId,"in extension:",s);const f=h.upsertInstance({id:e.body.id,characterId:e.body.characterId,name:u||void 0});console.log(i.green(l),"Instance upserted successfully for ID:",e.body.id,"in extension:",s),t.json(f)}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"POST /instances failed with error for instance ID:",e.body.id,"error:",n),t.status(500).json({error:n})}}deleteInstance(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid instance ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return void t.status(404).json({error:`Database not found for extension: ${r}`});if(!s.deleteInstance(n))return void t.status(404).json({error:"Instance not found"});t.json({success:!0})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getInstanceData(e,t){try{console.log(i.blue(l),"GET /instances/:id/data called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"GET /instances/:id/data failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return console.log(i.yellow(l),"GET /instances/:id/data failed: Invalid instance ID format:",n),void t.status(400).json({error:"Valid instance ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return console.log(i.yellow(l),"GET /instances/:id/data failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});console.log(i.blue(l),"Retrieving data for instance with ID:",e.params.id,"in extension:",r);const o=s.getData(e.params.id);console.log(i.blue(l),"GET /instances/:id/data successful for instance ID:",e.params.id,"in extension:",r,"Returning",Object.keys(o).length,"data entries"),t.json(o)}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"GET /instances/:id/data failed with error for instance ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}getInstanceDataKey(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n,key:s}=e.params;if(!(0,a.isValidId)(n)||"string"!=typeof s||0===s.trim().length)return void t.status(400).json({error:"Valid instance ID and key are required (alphanumeric, hyphens, underscores only for ID)"});const o=this.crossExtensionReader.getDbManager(r);if(!o)return void t.status(404).json({error:`Database not found for extension: ${r}`});const i=o.getDataValue(n,s);t.json({[s]:i})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}upsertInstanceData(e,t){var r,n;try{console.log(i.blue(l),"POST /instances/:id/data called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const s=this.getExtensionIdFromHeader(e);if(!s)return console.log(i.yellow(l),"POST /instances/:id/data failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:o}=e.params,{key:c,value:d}=e.body,u=(0,a.validateRequestBody)(["key"],e.body);if(!u.isValid)return console.log(i.yellow(l),"POST /instances/:id/data failed: Missing required fields:",null===(r=u.missingFields)||void 0===r?void 0:r.join(", ")),void t.status(400).json({error:`Missing required fields: ${null===(n=u.missingFields)||void 0===n?void 0:n.join(", ")}`});if(!(0,a.isValidId)(o)||"string"!=typeof c||0===c.trim().length)return console.log(i.yellow(l),"POST /instances/:id/data failed: Invalid instance ID or data key format"),void t.status(400).json({error:"Valid instance ID and data key are required (alphanumeric, hyphens, underscores only for ID)"});const h=this.crossExtensionReader.getDbManager(s);if(!h)return console.log(i.yellow(l),"POST /instances/:id/data failed: Database not found for extension:",s),void t.status(404).json({error:`Database not found for extension: ${s}`});console.log(i.blue(l),"Upserting data for instance ID:",e.params.id,"key:",e.body.key,"value:",e.body.value,"in extension:",s),h.upsertData(e.params.id,e.body.key,e.body.value),console.log(i.green(l),"Data upserted successfully for instance ID:",e.params.id,"key:",e.body.key,"in extension:",s),t.json({success:!0,key:e.body.key,value:e.body.value})}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"POST /instances/:id/data failed with error for instance ID:",e.params.id,"key:",e.body.key,"error:",n),t.status(500).json({error:n})}}deleteInstanceDataKey(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n,key:s}=e.params;if(!(0,a.isValidId)(n)||"string"!=typeof s||0===s.trim().length)return void t.status(400).json({error:"Valid instance ID and key are required (alphanumeric, hyphens, underscores only for ID)"});const o=this.crossExtensionReader.getDbManager(r);if(!o)return void t.status(404).json({error:`Database not found for extension: ${r}`});if(!o.deleteDataValue(n,s))return void t.status(404).json({error:"Data key not found"});t.json({success:!0})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}clearInstanceData(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params;if(!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid instance ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return void t.status(404).json({error:`Database not found for extension: ${r}`});if(!s.clearInstanceData(n))return void t.status(404).json({error:"Instance not found"});t.json({success:!0})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}deleteAllInstancesForCharacter(e,t){try{const r=this.getExtensionIdFromHeader(e);if(!r)return void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{characterId:n}=e.params;if(!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid character ID is required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getDbManager(r);if(!s)return void t.status(404).json({error:`Database not found for extension: ${r}`});const o=s.getInstancesByCharacter(n);let i=0;for(const e of o)s.deleteInstance(e.id)&&i++;t.json({success:!0,deletedCount:i})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}overrideInstanceData(e,t){try{console.log(i.blue(l),"PUT /instances/:id/data/override called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"PUT /instances/:id/data/override failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params,s=e.body;if(!(0,a.isValidId)(n)||"object"!=typeof s||null===s||Array.isArray(s))return console.log(i.yellow(l),"PUT /instances/:id/data/override failed: Valid instance ID and data object are required"),void t.status(400).json({error:"Valid instance ID and data object are required"});const o=this.crossExtensionReader.getDbManager(r);if(!o)return console.log(i.yellow(l),"PUT /instances/:id/data/override failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});console.log(i.blue(l),"Overriding instance data for instance ID:",e.params.id,"in extension:",r,"with",Object.keys(s).length,"data entries"),o.clearInstanceData(e.params.id);for(const[t,r]of Object.entries(s))"string"==typeof t&&t.trim().length>0&&o.upsertData(e.params.id,t,r);console.log(i.green(l),"Instance data overridden successfully for instance ID:",e.params.id,"in extension:",r),t.json({success:!0,message:"Instance data overridden successfully"})}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"PUT /instances/:id/data/override failed with error for instance ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}mergeInstanceData(e,t){try{console.log(i.blue(l),"PUT /instances/:id/data/merge called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const r=this.getExtensionIdFromHeader(e);if(!r)return console.log(i.yellow(l),"PUT /instances/:id/data/merge failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:n}=e.params,s=e.body;if(!(0,a.isValidId)(n)||"object"!=typeof s||null===s||Array.isArray(s))return console.log(i.yellow(l),"PUT /instances/:id/data/merge failed: Valid instance ID and data object are required"),void t.status(400).json({error:"Valid instance ID and data object are required"});const o=this.crossExtensionReader.getDbManager(r);if(!o)return console.log(i.yellow(l),"PUT /instances/:id/data/merge failed: Database not found for extension:",r),void t.status(404).json({error:`Database not found for extension: ${r}`});console.log(i.blue(l),"Merging instance data for instance ID:",e.params.id,"in extension:",r,"with",Object.keys(s).length,"data entries");for(const[t,r]of Object.entries(s))"string"==typeof t&&t.trim().length>0&&o.upsertData(e.params.id,t,r);console.log(i.green(l),"Instance data merged successfully for instance ID:",e.params.id,"in extension:",r),t.json({success:!0,message:"Instance data merged successfully"})}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"PUT /instances/:id/data/merge failed with error for instance ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}removeInstanceDataKeys(e,t){var r,n;try{console.log(i.blue(l),"PUT /instances/:id/data/remove called from IP:",e.ip||e.socket&&e.socket.remoteAddress,"for instance ID:",e.params.id);const s=this.getExtensionIdFromHeader(e);if(!s)return console.log(i.yellow(l),"PUT /instances/:id/data/remove failed: Extension ID is required in header"),void t.status(400).json({error:"Extension ID is required in header: x-extension-id"});const{id:o}=e.params,{keys:c}=e.body,d=(0,a.validateRequestBody)(["keys"],e.body);if(!d.isValid)return console.log(i.yellow(l),"PUT /instances/:id/data/remove failed: Missing required fields:",null===(r=d.missingFields)||void 0===r?void 0:r.join(", ")),void t.status(400).json({error:`Missing required fields: ${null===(n=d.missingFields)||void 0===n?void 0:n.join(", ")}`});if(!(0,a.isValidId)(o)||!Array.isArray(c))return console.log(i.yellow(l),"PUT /instances/:id/data/remove failed: Valid instance ID and keys array are required"),void t.status(400).json({error:"Valid instance ID and keys array are required"});for(const e of c)if("string"!=typeof e)return console.log(i.yellow(l),"PUT /instances/:id/data/remove failed: All keys must be strings"),void t.status(400).json({error:"All keys must be strings"});const u=this.crossExtensionReader.getDbManager(s);if(!u)return console.log(i.yellow(l),"PUT /instances/:id/data/remove failed: Database not found for extension:",s),void t.status(404).json({error:`Database not found for extension: ${s}`});console.log(i.blue(l),"Removing instance data keys for instance ID:",e.params.id,"in extension:",s,"from",e.body.keys.length,"keys");let h=0;for(const t of e.body.keys)"string"==typeof t&&t.trim().length>0&&u.deleteDataValue(e.params.id,t)&&h++;console.log(i.green(l),"Instance data keys removed successfully for instance ID:",e.params.id,"in extension:",s,"Removed:",h,"keys"),t.json({success:!0,removedCount:h})}catch(r){const n=r instanceof Error?r.message:"Unknown error";console.error(i.red(l),"PUT /instances/:id/data/remove failed with error for instance ID:",e.params.id,"error:",n),t.status(500).json({error:n})}}registerExtension(e,t){var r,n;try{console.log(i.blue(l),"Register endpoint called from IP:",e.ip||e.socket&&e.socket.remoteAddress);const{extensionId:s,dbPath:c}=e.body,d=(0,a.validateRequestBody)(["extensionId"],e.body);if(!d.isValid)return console.log(i.yellow(l),"Registration failed: Missing required fields:",null===(r=d.missingFields)||void 0===r?void 0:r.join(", ")),void t.status(400).json({error:`Missing required fields: ${null===(n=d.missingFields)||void 0===n?void 0:n.join(", ")}`});if("string"!=typeof s)return console.log(i.yellow(l),"Registration failed: extensionId must be a string, got:",typeof s),void t.status(400).json({error:"extensionId must be a string"});if(!(0,a.isValidId)(s))return console.log(i.yellow(l),"Registration failed: Invalid extension ID format:",s),void t.status(400).json({error:"Valid extension ID is required (alphanumeric, hyphens, underscores only)"});if(void 0!==c)return console.log(i.yellow(l),"Registration failed: dbPath parameter not allowed for security reasons"),void t.status(400).json({error:"dbPath parameter not allowed for security reasons"});console.log(i.blue(l),"Creating database manager for extension:",s);const u=new o.DatabaseManager(c,s);console.log(i.blue(l),"Registering extension database for extension:",s),this.crossExtensionReader.registerExtensionDatabase(s,u),console.log(i.green(l),"Extension registered successfully:",s),t.json({success:!0,message:`Extension ${s} registered successfully`})}catch(e){const r=e instanceof Error?e.message:"Unknown error",n=e instanceof Error?e.stack:"No stack trace available";console.error(i.red(l),"Registration failed with error:",r),console.error(i.red(l),"Stack trace:",n),t.status(500).json({error:r})}}deregisterExtension(e,t){try{console.log(i.blue(l),"Deregister endpoint called from IP:",e.ip||e.socket&&e.socket.remoteAddress);const{extensionId:r}=e.body;if(!r)return console.log(i.yellow(l),"Deregistration failed: Extension ID is required in request body"),void t.status(400).json({error:"Extension ID is required in request body"});if("string"!=typeof r)return console.log(i.yellow(l),"Deregistration failed: extensionId must be a string, got:",typeof r),void t.status(400).json({error:"extensionId must be a string"});if(!(0,a.isValidId)(r))return console.log(i.yellow(l),"Deregistration failed: Invalid extension ID format:",r),void t.status(400).json({error:"Valid extension ID is required (alphanumeric, hyphens, underscores only)"});console.log(i.blue(l),"Deregistering extension database for extension:",r),this.crossExtensionReader.deregisterExtensionDatabase(r),console.log(i.green(l),"Extension deregistered successfully:",r),t.json({success:!0,message:`Extension ${r} deregistered successfully`})}catch(e){const r=e instanceof Error?e.message:"Unknown error",n=e instanceof Error?e.stack:"No stack trace available";console.error(i.red(l),"Deregistration failed with error:",r),console.error(i.red(l),"Stack trace:",n),t.status(500).json({error:r})}}getCrossExtensionCharacter(e,t){try{const{extensionId:r,id:n}=e.params;if(!(0,a.isValidId)(r)||!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid extension ID and character ID are required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getFullCharacter(r,n);if(!s)return void t.status(404).json({error:`Character not found in extension ${r}`});t.json(s)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getCrossExtensionInstance(e,t){try{const{extensionId:r,id:n}=e.params;if(!(0,a.isValidId)(r)||!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid extension ID and instance ID are required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getFullInstance(r,n);if(!s)return void t.status(404).json({error:`Instance not found in extension ${r}`});t.json(s)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getCrossExtensionInstanceData(e,t){try{const{extensionId:r,id:n}=e.params;if(!(0,a.isValidId)(r)||!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid extension ID and instance ID are required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getInstanceData(r,n);t.json(s)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getCrossExtensionInstanceDataKey(e,t){try{const{extensionId:r,id:n,key:s}=e.params;if(!(0,a.isValidId)(r)||!(0,a.isValidId)(n)||"string"!=typeof s||0===s.trim().length)return void t.status(400).json({error:"Valid extension ID, instance ID, and key are required (alphanumeric, hyphens, underscores only for IDs)"});const o=this.crossExtensionReader.getDataValue(r,n,s);t.json({[s]:o})}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getCrossExtensionAllCharacters(e,t){try{const{extensionId:r}=e.params;if(!(0,a.isValidId)(r))return void t.status(400).json({error:"Valid extension ID is required (alphanumeric, hyphens, underscores only)"});const n=this.crossExtensionReader.getAllCharacters(r);t.json(n)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}getCrossExtensionInstancesByCharacter(e,t){try{const{extensionId:r,characterId:n}=e.params;if(!(0,a.isValidId)(r)||!(0,a.isValidId)(n))return void t.status(400).json({error:"Valid extension ID and character ID are required (alphanumeric, hyphens, underscores only)"});const s=this.crossExtensionReader.getInstancesByCharacter(r,n);t.json(s)}catch(e){const r=e instanceof Error?e.message:"Unknown error";t.status(500).json({error:r})}}}},826:(e,t,r)=>{e=r.nmd(e);var n=void 0,s=function(t){return n||(n=new Promise(function(n,s){var o,a=void 0!==t?t:{},i=a.onAbort;a.onAbort=function(e){s(new Error(e)),i&&i(e)},a.postRun=a.postRun||[],a.postRun.push(function(){n(a)}),e=void 0,o||=void 0!==a?a:{};var l="object"==typeof window,c="undefined"!=typeof WorkerGlobalScope,d="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;o.onRuntimeInitialized=function(){function e(e,t){switch(typeof t){case"boolean":K(e,t?1:0);break;case"number":$(e,t);break;case"string":z(e,t,-1,-1);break;case"object":if(null===t)G(e);else if(null!=t.length){var r=yt(t,pt);X(e,r,t.length,-1),Dt(r)}else J(e,"Wrong API use : tried to return a value of an unknown type ("+t+").",-1);break;default:G(e)}}function t(e,t){for(var r=[],n=0;n<e;n+=1){var s=H(t+4*n,"i32"),o=U(s);if(1===o||2===o)s=V(s);else if(3===o)s=L(s);else if(4===o){s=N(o=s),o=F(o);for(var a=new Uint8Array(s),i=0;i<s;i+=1)a[i]=I[o+i];s=a}else s=null;r.push(s)}return r}function r(e,t){this.Qa=e,this.db=t,this.Oa=1,this.lb=[]}function n(e,t){if(this.db=t,t=te(e)+1,this.eb=_t(t),null===this.eb)throw Error("Unable to allocate memory for the SQL string");re(e,x,this.eb,t),this.kb=this.eb,this.Za=this.pb=null}function s(e){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=e){var t=this.filename,r="/",n=t;if(r&&(r="string"==typeof r?r:xe(r),n=t?Y(r+"/"+t):r),n=function(e,t=438){return Fe(e,4095&t|32768,0)}(n,t=de(!0,!0)),e){if("string"==typeof e){r=Array(e.length);for(var s=0,o=e.length;s<o;++s)r[s]=e.charCodeAt(s);e=r}Qe(n,146|t),et(r=Ye(n,577),e,0,e.length,0),Ke(r),Qe(n,t)}}this.handleError(l(this.filename,a)),this.db=H(a,"i32"),ee(this.db),this.fb={},this.Sa={}}var a=Rt(4),i=o.cwrap,l=i("sqlite3_open","number",["string","number"]),c=i("sqlite3_close_v2","number",["number"]),d=i("sqlite3_exec","number",["number","string","number","number","number"]),u=i("sqlite3_changes","number",["number"]),h=i("sqlite3_prepare_v2","number",["number","string","number","number","number"]),f=i("sqlite3_sql","string",["number"]),g=i("sqlite3_normalized_sql","string",["number"]),b=i("sqlite3_prepare_v2","number",["number","number","number","number","number"]),m=i("sqlite3_bind_text","number",["number","number","number","number","number"]),p=i("sqlite3_bind_blob","number",["number","number","number","number","number"]),y=i("sqlite3_bind_double","number",["number","number","number"]),w=i("sqlite3_bind_int","number",["number","number","number"]),E=i("sqlite3_bind_parameter_index","number",["number","string"]),v=i("sqlite3_step","number",["number"]),_=i("sqlite3_errmsg","string",["number"]),D=i("sqlite3_column_count","number",["number"]),T=i("sqlite3_data_count","number",["number"]),q=i("sqlite3_column_double","number",["number","number"]),k=i("sqlite3_column_text","string",["number","number"]),R=i("sqlite3_column_blob","number",["number","number"]),j=i("sqlite3_column_bytes","number",["number","number"]),A=i("sqlite3_column_type","number",["number","number"]),P=i("sqlite3_column_name","string",["number","number"]),M=i("sqlite3_reset","number",["number"]),C=i("sqlite3_clear_bindings","number",["number"]),S=i("sqlite3_finalize","number",["number"]),O=i("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),U=i("sqlite3_value_type","number",["number"]),N=i("sqlite3_value_bytes","number",["number"]),L=i("sqlite3_value_text","string",["number"]),F=i("sqlite3_value_blob","number",["number"]),V=i("sqlite3_value_double","number",["number"]),$=i("sqlite3_result_double","",["number","number"]),G=i("sqlite3_result_null","",["number"]),z=i("sqlite3_result_text","",["number","string","number","number"]),X=i("sqlite3_result_blob","",["number","number","number","number"]),K=i("sqlite3_result_int","",["number","number"]),J=i("sqlite3_result_error","",["number","string","number"]),Z=i("sqlite3_aggregate_context","number",["number","number"]),ee=i("RegisterExtensionFunctions","number",["number"]),se=i("sqlite3_update_hook","number",["number","number","number"]);r.prototype.bind=function(e){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(e)?this.Cb(e):null==e||"object"!=typeof e||this.Db(e)},r.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var e=v(this.Qa);switch(e){case 100:return!0;case 101:return!1;default:throw this.db.handleError(e)}},r.prototype.wb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),q(this.Qa,e)},r.prototype.Gb=function(e){if(null==e&&(e=this.Oa,this.Oa+=1),e=k(this.Qa,e),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(e)},r.prototype.Hb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),k(this.Qa,e)},r.prototype.getBlob=function(e){null==e&&(e=this.Oa,this.Oa+=1);var t=j(this.Qa,e);e=R(this.Qa,e);for(var r=new Uint8Array(t),n=0;n<t;n+=1)r[n]=I[e+n];return r},r.prototype.get=function(e,t){t=t||{},null!=e&&this.bind(e)&&this.step(),e=[];for(var r=T(this.Qa),n=0;n<r;n+=1)switch(A(this.Qa,n)){case 1:var s=t.useBigInt?this.Gb(n):this.wb(n);e.push(s);break;case 2:e.push(this.wb(n));break;case 3:e.push(this.Hb(n));break;case 4:e.push(this.getBlob(n));break;default:e.push(null)}return e},r.prototype.getColumnNames=function(){for(var e=[],t=D(this.Qa),r=0;r<t;r+=1)e.push(P(this.Qa,r));return e},r.prototype.getAsObject=function(e,t){e=this.get(e,t),t=this.getColumnNames();for(var r={},n=0;n<t.length;n+=1)r[t[n]]=e[n];return r},r.prototype.getSQL=function(){return f(this.Qa)},r.prototype.getNormalizedSQL=function(){return g(this.Qa)},r.prototype.run=function(e){return null!=e&&this.bind(e),this.step(),this.reset()},r.prototype.sb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),e=ne(e);var r=yt(e,pt);this.lb.push(r),this.db.handleError(m(this.Qa,t,r,e.length-1,0))},r.prototype.Bb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1);var r=yt(e,pt);this.lb.push(r),this.db.handleError(p(this.Qa,t,r,e.length,0))},r.prototype.rb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),this.db.handleError((e===(0|e)?w:y)(this.Qa,t,e))},r.prototype.Eb=function(e){null==e&&(e=this.Oa,this.Oa+=1),p(this.Qa,e,0,0,0)},r.prototype.tb=function(e,t){switch(null==t&&(t=this.Oa,this.Oa+=1),typeof e){case"string":return void this.sb(e,t);case"number":return void this.rb(e,t);case"bigint":return void this.sb(e.toString(),t);case"boolean":return void this.rb(e+0,t);case"object":if(null===e)return void this.Eb(t);if(null!=e.length)return void this.Bb(e,t)}throw"Wrong API use : tried to bind a value of an unknown type ("+e+")."},r.prototype.Db=function(e){var t=this;return Object.keys(e).forEach(function(r){var n=E(t.Qa,r);0!==n&&t.tb(e[r],n)}),!0},r.prototype.Cb=function(e){for(var t=0;t<e.length;t+=1)this.tb(e[t],t+1);return!0},r.prototype.reset=function(){return this.freemem(),0===C(this.Qa)&&0===M(this.Qa)},r.prototype.freemem=function(){for(var e;void 0!==(e=this.lb.pop());)Dt(e)},r.prototype.free=function(){this.freemem();var e=0===S(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,e},n.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var e=jt(),t=Rt(4);B(a),B(t);try{this.db.handleError(b(this.db.db,this.kb,-1,a,t)),this.kb=H(t,"i32");var n=H(a,"i32");return 0===n?(this.mb(),{done:!0}):(this.Za=new r(n,this.db),this.db.fb[n]=this.Za,{value:this.Za,done:!1})}catch(e){throw this.pb=Q(this.kb),this.mb(),e}finally{kt(e)}},n.prototype.mb=function(){Dt(this.eb),this.eb=null},n.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:Q(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(n.prototype[Symbol.iterator]=function(){return this}),s.prototype.run=function(e,t){if(!this.db)throw"Database closed";if(t){e=this.prepare(e,t);try{e.step()}finally{e.free()}}else this.handleError(d(this.db,e,0,0,a));return this},s.prototype.exec=function(e,t,n){if(!this.db)throw"Database closed";var s=jt(),o=null;try{var i=mt(e),l=Rt(4);for(e=[];0!==H(i,"i8");){B(a),B(l),this.handleError(b(this.db,i,-1,a,l));var c=H(a,"i32");if(i=H(l,"i32"),0!==c){var d=null;for(o=new r(c,this),null!=t&&o.bind(t);o.step();)null===d&&(d={columns:o.getColumnNames(),values:[]},e.push(d)),d.values.push(o.get(null,n));o.free()}}return e}catch(e){throw o&&o.free(),e}finally{kt(s)}},s.prototype.each=function(e,t,r,n,s){"function"==typeof t&&(n=r,r=t,t=void 0),e=this.prepare(e,t);try{for(;e.step();)r(e.getAsObject(null,s))}finally{e.free()}if("function"==typeof n)return n()},s.prototype.prepare=function(e,t){if(B(a),this.handleError(h(this.db,e,-1,a,0)),0===(e=H(a,"i32")))throw"Nothing to prepare";var n=new r(e,this);return null!=t&&n.bind(t),this.fb[e]=n},s.prototype.iterateStatements=function(e){return new n(e,this)},s.prototype.export=function(){Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(Et),this.Sa={},this.handleError(c(this.db));var e=function(e){var t;var r=Ye(e,r||0);e=ze(e).size;var n=new Uint8Array(e);return Ze(r,n,0,e,0),t=n,Ke(r),t}(this.filename);return this.handleError(l(this.filename,a)),this.db=H(a,"i32"),ee(this.db),e},s.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(Et),this.Sa={},this.Ya&&(Et(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),Be("/"+this.filename),this.db=null)},s.prototype.handleError=function(e){if(0===e)return null;throw e=_(this.db),Error(e)},s.prototype.getRowsModified=function(){return u(this.db)},s.prototype.create_function=function(r,n){Object.prototype.hasOwnProperty.call(this.Sa,r)&&(Et(this.Sa[r]),delete this.Sa[r]);var s=vt(function(r,s,o){s=t(s,o);try{var a=n.apply(null,s)}catch(e){return void J(r,e,-1)}e(r,a)},"viii");return this.Sa[r]=s,this.handleError(O(this.db,r,n.length,1,0,s,0,0,0)),this},s.prototype.create_aggregate=function(r,n){var s=n.init||function(){return null},o=n.finalize||function(e){return e},a=n.step;if(!a)throw"An aggregate function must have a step function in "+r;var i={};Object.hasOwnProperty.call(this.Sa,r)&&(Et(this.Sa[r]),delete this.Sa[r]),n=r+"__finalize",Object.hasOwnProperty.call(this.Sa,n)&&(Et(this.Sa[n]),delete this.Sa[n]);var l=vt(function(e,r,n){var o=Z(e,1);Object.hasOwnProperty.call(i,o)||(i[o]=s()),r=t(r,n),r=[i[o]].concat(r);try{i[o]=a.apply(null,r)}catch(t){delete i[o],J(e,t,-1)}},"viii"),c=vt(function(t){var r=Z(t,1);try{var n=o(i[r])}catch(e){return delete i[r],void J(t,e,-1)}e(t,n),delete i[r]},"vi");return this.Sa[r]=l,this.Sa[n]=c,this.handleError(O(this.db,r,a.length-1,1,0,0,l,c,0)),this},s.prototype.updateHook=function(e){this.Ya&&(se(this.db,0,0),Et(this.Ya),this.Ya=void 0),e&&(this.Ya=vt(function(t,r,n,s,o){switch(r){case 18:t="insert";break;case 23:t="update";break;case 9:t="delete";break;default:throw"unknown operationCode in updateHook callback: "+r}if(n=n?W(x,n):"",s=s?W(x,s):"",o>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";e(t,n,s,Number(o))},"viiiij"),se(this.db,this.Ya,0))},o.Database=s};var u,h,f={...o},g="./this.program",b=(e,t)=>{throw t},m="";if(d){var p=r(383);r(3),m=__dirname+"/",h=e=>(e=P(e)?new URL(e):e,p.readFileSync(e)),u=async e=>(e=P(e)?new URL(e):e,p.readFileSync(e,void 0)),!o.thisProgram&&1<process.argv.length&&(g=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),e.exports=o,b=(e,t)=>{throw process.exitCode=e,t}}else(l||c)&&(c?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),m=m.startsWith("blob:")?"":m.slice(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(h=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),u=async e=>{if(P(e))return new Promise((t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r(n.status)},n.onerror=r,n.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)});var y=o.print||console.log.bind(console),w=o.printErr||console.error.bind(console);Object.assign(o,f),f=null,o.thisProgram&&(g=o.thisProgram);var E,v,I,x,_,D,T,q,k,R,j=o.wasmBinary,A=!1,P=e=>e.startsWith("file://");function M(){var e=E.buffer;o.HEAP8=I=new Int8Array(e),o.HEAP16=_=new Int16Array(e),o.HEAPU8=x=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAP32=D=new Int32Array(e),o.HEAPU32=T=new Uint32Array(e),o.HEAPF32=q=new Float32Array(e),o.HEAPF64=R=new Float64Array(e),o.HEAP64=k=new BigInt64Array(e),o.HEAPU64=new BigUint64Array(e)}var C,S=0,O=null;function U(e){throw o.onAbort?.(e),w(e="Aborted("+e+")"),A=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}class N{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var L=e=>{for(;0<e.length;)e.shift()(o)},F=[],V=[],$=()=>{var e=o.preRun.shift();V.unshift(e)};function H(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return I[e];case"i16":return _[e>>1];case"i32":return D[e>>2];case"i64":return k[e>>3];case"float":return q[e>>2];case"double":return R[e>>3];case"*":return T[e>>2];default:U(`invalid type for getValue: ${t}`)}}var G=o.noExitRuntime||!0;function B(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":I[e]=0;break;case"i16":_[e>>1]=0;break;case"i32":D[e>>2]=0;break;case"i64":k[e>>3]=BigInt(0);break;case"float":q[e>>2]=0;break;case"double":R[e>>3]=0;break;case"*":T[e>>2]=0;break;default:U(`invalid type for setValue: ${t}`)}}var z="undefined"!=typeof TextDecoder?new TextDecoder:void 0,W=(e,t=0,r=NaN)=>{var n=t+r;for(r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&z)return z.decode(e.subarray(t,r));for(n="";t<r;){var s=e[t++];if(128&s){var o=63&e[t++];if(192==(224&s))n+=String.fromCharCode((31&s)<<6|o);else{var a=63&e[t++];65536>(s=224==(240&s)?(15&s)<<12|o<<6|a:(7&s)<<18|o<<12|a<<6|63&e[t++])?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else n+=String.fromCharCode(s)}return n},Q=(e,t)=>e?W(x,e,t):"",X=(e,t)=>{for(var r=0,n=e.length-1;0<=n;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},Y=e=>{var t="/"===e.charAt(0),r="/"===e.slice(-1);return(e=X(e.split("/").filter(e=>!!e),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},K=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&=t.slice(0,-1),e+t):"."},J=e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],Z=e=>{(Z=(()=>{if(d){var e=r(749);return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)})())(e)},ee=[],te=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}return t},re=(e,t,r,n)=>{if(!(0<n))return 0;var s=r;n=r+n-1;for(var o=0;o<e.length;++o){var a=e.charCodeAt(o);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),127>=a){if(r>=n)break;t[r++]=a}else{if(2047>=a){if(r+1>=n)break;t[r++]=192|a>>6}else{if(65535>=a){if(r+2>=n)break;t[r++]=224|a>>12}else{if(r+3>=n)break;t[r++]=240|a>>18,t[r++]=128|a>>12&63}t[r++]=128|a>>6&63}t[r++]=128|63&a}}return t[r]=0,r-s},ne=(e,t)=>{var r=Array(te(e)+1);return e=re(e,r,0,r.length),t&&(r.length=e),r},se=[];function oe(e,t){se[e]={input:[],output:[],cb:t},Ne(e,ae)}var ae={open(e){var t=se[e.node.rdev];if(!t)throw new we(43);e.tty=t,e.seekable=!1},close(e){e.tty.cb.fsync(e.tty)},fsync(e){e.tty.cb.fsync(e.tty)},read(e,t,r,n){if(!e.tty||!e.tty.cb.xb)throw new we(60);for(var s=0,o=0;o<n;o++){try{var a=e.tty.cb.xb(e.tty)}catch(e){throw new we(29)}if(void 0===a&&0===s)throw new we(6);if(null==a)break;s++,t[r+o]=a}return s&&(e.node.atime=Date.now()),s},write(e,t,r,n){if(!e.tty||!e.tty.cb.qb)throw new we(60);try{for(var s=0;s<n;s++)e.tty.cb.qb(e.tty,t[r+s])}catch(e){throw new we(29)}return n&&(e.node.mtime=e.node.ctime=Date.now()),s}},ie={xb(){e:{if(!ee.length){var e=null;if(d){var t=Buffer.alloc(256),r=0,n=process.stdin.fd;try{r=p.readSync(n,t,0,256)}catch(e){if(!e.toString().includes("EOF"))throw e;r=0}0<r&&(e=t.slice(0,r).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&null!==(e=window.prompt("Input: "))&&(e+="\n");if(!e){e=null;break e}ee=ne(e,!0)}e=ee.shift()}return e},qb(e,t){null===t||10===t?(y(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){0<e.output?.length&&(y(W(e.output)),e.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},le={qb(e,t){null===t||10===t?(w(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){0<e.output?.length&&(w(W(e.output)),e.output=[])}},ce={Wa:null,Xa:()=>ce.createNode(null,"/",16895,0),createNode(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new we(63);return ce.Wa||(ce.Wa={dir:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,lookup:ce.La.lookup,hb:ce.La.hb,rename:ce.La.rename,unlink:ce.La.unlink,rmdir:ce.La.rmdir,readdir:ce.La.readdir,symlink:ce.La.symlink},stream:{Va:ce.Ma.Va}},file:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:{Va:ce.Ma.Va,read:ce.Ma.read,write:ce.Ma.write,ib:ce.Ma.ib,jb:ce.Ma.jb}},link:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,readlink:ce.La.readlink},stream:{}},ub:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:Ue}}),ke((r=qe(e,t,r,n)).mode)?(r.La=ce.Wa.dir.node,r.Ma=ce.Wa.dir.stream,r.Na={}):32768==(61440&r.mode)?(r.La=ce.Wa.file.node,r.Ma=ce.Wa.file.stream,r.Ra=0,r.Na=null):40960==(61440&r.mode)?(r.La=ce.Wa.link.node,r.Ma=ce.Wa.link.stream):8192==(61440&r.mode)&&(r.La=ce.Wa.ub.node,r.Ma=ce.Wa.ub.stream),r.atime=r.mtime=r.ctime=Date.now(),e&&(e.Na[t]=r,e.atime=e.mtime=e.ctime=r.atime),r},Sb:e=>e.Na?e.Na.subarray?e.Na.subarray(0,e.Ra):new Uint8Array(e.Na):new Uint8Array(0),La:{Ta(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,ke(e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.Ra:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},Ua(e,t){for(var r of["mode","atime","mtime","ctime"])null!=t[r]&&(e[r]=t[r]);void 0!==t.size&&(t=t.size,e.Ra!=t&&(0==t?(e.Na=null,e.Ra=0):(r=e.Na,e.Na=new Uint8Array(t),r&&e.Na.set(r.subarray(0,Math.min(t,e.Ra))),e.Ra=t)))},lookup(){throw ce.vb},hb:(e,t,r,n)=>ce.createNode(e,t,r,n),rename(e,t,r){try{var n=Te(t,r)}catch(e){}if(n){if(ke(e.mode))for(var s in n.Na)throw new we(55);De(n)}delete e.parent.Na[e.name],t.Na[r]=e,e.name=r,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.Na[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var r,n=Te(e,t);for(r in n.Na)throw new we(55);delete e.Na[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.Na)],symlink:(e,t,r)=>((e=ce.createNode(e,t,41471,0)).link=r,e),readlink(e){if(40960!=(61440&e.mode))throw new we(28);return e.link}},Ma:{read(e,t,r,n,s){var o=e.node.Na;if(s>=e.node.Ra)return 0;if(8<(e=Math.min(e.node.Ra-s,n))&&o.subarray)t.set(o.subarray(s,s+e),r);else for(n=0;n<e;n++)t[r+n]=o[s+n];return e},write(e,t,r,n,s,o){if(t.buffer===I.buffer&&(o=!1),!n)return 0;if((e=e.node).mtime=e.ctime=Date.now(),t.subarray&&(!e.Na||e.Na.subarray)){if(o)return e.Na=t.subarray(r,r+n),e.Ra=n;if(0===e.Ra&&0===s)return e.Na=t.slice(r,r+n),e.Ra=n;if(s+n<=e.Ra)return e.Na.set(t.subarray(r,r+n),s),n}o=s+n;var a=e.Na?e.Na.length:0;if(a>=o||(o=Math.max(o,a*(1048576>a?2:1.125)>>>0),0!=a&&(o=Math.max(o,256)),a=e.Na,e.Na=new Uint8Array(o),0<e.Ra&&e.Na.set(a.subarray(0,e.Ra),0)),e.Na.subarray&&t.subarray)e.Na.set(t.subarray(r,r+n),s);else for(o=0;o<n;o++)e.Na[s+o]=t[r+o];return e.Ra=Math.max(e.Ra,s+n),n},Va(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.node.mode)&&(t+=e.node.Ra),0>t)throw new we(28);return t},ib(e,t,r,n,s){if(32768!=(61440&e.node.mode))throw new we(43);if(e=e.node.Na,2&s||!e||e.buffer!==I.buffer){s=!0,n=65536*Math.ceil(t/65536);var o=Tt(65536,n);if(o&&x.fill(0,o,o+n),!(n=o))throw new we(48);e&&((0<r||r+t<e.length)&&(e=e.subarray?e.subarray(r,r+t):Array.prototype.slice.call(e,r,r+t)),I.set(e,n))}else s=!1,n=e.byteOffset;return{Kb:n,Ab:s}},jb:(e,t,r,n)=>(ce.Ma.write(e,t,0,n,r,!1),0)}},de=(e,t)=>{var r=0;return e&&(r|=365),t&&(r|=146),r},ue=null,he={},fe=[],ge=1,be=null,me=!1,pe=!0,ye={},we=class{name="ErrnoError";constructor(e){this.Pa=e}},Ee=class{gb={};node=null;get flags(){return this.gb.flags}set flags(e){this.gb.flags=e}get position(){return this.gb.position}set position(e){this.gb.position=e}},ve=class{La={};Ma={};ab=null;constructor(e,t,r,n){e||=this,this.parent=e,this.Xa=e.Xa,this.id=ge++,this.name=t,this.mode=r,this.rdev=n,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(e){e?this.mode|=146:this.mode&=-147}};function Ie(e,t={}){if(!e)throw new we(44);t.nb??(t.nb=!0),"/"===e.charAt(0)||(e="//"+e);var r=0;e:for(;40>r;r++){e=e.split("/").filter(e=>!!e);for(var n=ue,s="/",o=0;o<e.length;o++){var a=o===e.length-1;if(a&&t.parent)break;if("."!==e[o])if(".."===e[o])s=K(s),n=n.parent;else{s=Y(s+"/"+e[o]);try{n=Te(n,e[o])}catch(e){if(44===e?.Pa&&a&&t.Jb)return{path:s};throw e}if(!n.ab||a&&!t.nb||(n=n.ab.root),40960==(61440&n.mode)&&(!a||t.$a)){if(!n.La.readlink)throw new we(52);"/"===(n=n.La.readlink(n)).charAt(0)||(n=K(s)+"/"+n),e=n+"/"+e.slice(o+1).join("/");continue e}}}return{path:s,node:n}}throw new we(32)}function xe(e){for(var t;;){if(e===e.parent)return e=e.Xa.zb,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function _e(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%be.length}function De(e){var t=_e(e.parent.id,e.name);if(be[t]===e)be[t]=e.bb;else for(t=be[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function Te(e,t){var r=ke(e.mode)?(r=je(e,"x"))?r:e.La.lookup?0:2:54;if(r)throw new we(r);for(r=be[_e(e.id,t)];r;r=r.bb){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.La.lookup(e,t)}function qe(e,t,r,n){return t=_e((e=new ve(e,t,r,n)).parent.id,e.name),e.bb=be[t],be[t]=e}function ke(e){return 16384==(61440&e)}function Re(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function je(e,t){return pe?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function Ae(e,t){if(!ke(e.mode))return 54;try{return Te(e,t),20}catch(e){}return je(e,"wx")}function Pe(e,t,r){try{var n=Te(e,t)}catch(e){return e.Pa}if(e=je(e,"wx"))return e;if(r){if(!ke(n.mode))return 54;if(n===n.parent||"/"===xe(n))return 10}else if(ke(n.mode))return 31;return 0}function Me(e){if(!e)throw new we(63);return e}function Ce(e){if(!(e=fe[e]))throw new we(8);return e}function Se(e,t=-1){if(e=Object.assign(new Ee,e),-1==t)e:{for(t=0;4096>=t;t++)if(!fe[t])break e;throw new we(33)}return e.fd=t,fe[t]=e}function Oe(e,t,r){var n=e?.Ma.Ua;e=n?e:t,n??=t.La.Ua,Me(n),n(e,r)}var Ue={open(e){e.Ma=he[e.node.rdev].Ma,e.Ma.open?.(e)},Va(){throw new we(70)}};function Ne(e,t){he[e]={Ma:t}}function Le(e,t){var r="/"===t;if(r&&ue)throw new we(10);if(!r&&t){var n=Ie(t,{nb:!1});if(t=n.path,(n=n.node).ab)throw new we(10);if(!ke(n.mode))throw new we(54)}t={type:e,Wb:{},zb:t,Ib:[]},(e=e.Xa(t)).Xa=t,t.root=e,r?ue=e:n&&(n.ab=t,n.Xa&&n.Xa.Ib.push(t))}function Fe(e,t,r){var n=Ie(e,{parent:!0}).node;if(!(e=J(e)))throw new we(28);if("."===e||".."===e)throw new we(20);var s=Ae(n,e);if(s)throw new we(s);if(!n.La.hb)throw new we(63);return n.La.hb(n,e,t,r)}function Ve(e,t=511){return Fe(e,1023&t|16384,0)}function $e(e,t,r){void 0===r&&(r=t,t=438),Fe(e,8192|t,r)}function He(e,t){if(!((...e)=>{for(var t="",r=!1,n=e.length-1;-1<=n&&!r;n--){if("string"!=typeof(r=0<=n?e[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";t=r+"/"+t,r="/"===r.charAt(0)}return(r?"/":"")+(t=X(t.split("/").filter(e=>!!e),!r).join("/"))||"."})(e))throw new we(44);var r=Ie(t,{parent:!0}).node;if(!r)throw new we(44);var n=Ae(r,t=J(t));if(n)throw new we(n);if(!r.La.symlink)throw new we(63);r.La.symlink(r,t,e)}function Ge(e){var t=Ie(e,{parent:!0}).node,r=Te(t,e=J(e)),n=Pe(t,e,!0);if(n)throw new we(n);if(!t.La.rmdir)throw new we(63);if(r.ab)throw new we(10);t.La.rmdir(t,e),De(r)}function Be(e){var t=Ie(e,{parent:!0}).node;if(!t)throw new we(44);var r=Te(t,e=J(e)),n=Pe(t,e,!1);if(n)throw new we(n);if(!t.La.unlink)throw new we(63);if(r.ab)throw new we(10);t.La.unlink(t,e),De(r)}function ze(e,t){return Me((e=Ie(e,{$a:!t}).node).La.Ta)(e)}function We(e,t,r,n){Oe(e,t,{mode:4095&r|-4096&t.mode,ctime:Date.now(),Fb:n})}function Qe(e,t){We(null,e="string"==typeof e?Ie(e,{$a:!0}).node:e,t)}function Xe(e,t,r){if(ke(t.mode))throw new we(31);if(32768!=(61440&t.mode))throw new we(28);var n=je(t,"w");if(n)throw new we(n);Oe(e,t,{size:r,timestamp:Date.now()})}function Ye(e,t,r=438){if(""===e)throw new we(44);if("string"==typeof t){var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===n)throw Error(`Unknown file open mode: ${t}`);t=n}if(r=64&t?4095&r|32768:0,"object"==typeof e)n=e;else{var s=e.endsWith("/");n=(e=Ie(e,{$a:!(131072&t),Jb:!0})).node,e=e.path}var a=!1;if(64&t)if(n){if(128&t)throw new we(20)}else{if(s)throw new we(31);n=Fe(e,511|r,0),a=!0}if(!n)throw new we(44);if(8192==(61440&n.mode)&&(t&=-513),65536&t&&!ke(n.mode))throw new we(54);if(!a&&(s=n?40960==(61440&n.mode)?32:ke(n.mode)&&("r"!==Re(t)||576&t)?31:je(n,Re(t)):44))throw new we(s);return 512&t&&!a&&Xe(null,s="string"==typeof(s=n)?Ie(s,{$a:!0}).node:s,0),t&=-131713,(s=Se({node:n,path:xe(n),flags:t,seekable:!0,position:0,Ma:n.Ma,Lb:[],error:!1})).Ma.open&&s.Ma.open(s),a&&Qe(n,511&r),!o.logReadFiles||1&t||e in ye||(ye[e]=1),s}function Ke(e){if(null===e.fd)throw new we(8);e.ob&&(e.ob=null);try{e.Ma.close&&e.Ma.close(e)}catch(e){throw e}finally{fe[e.fd]=null}e.fd=null}function Je(e,t,r){if(null===e.fd)throw new we(8);if(!e.seekable||!e.Ma.Va)throw new we(70);if(0!=r&&1!=r&&2!=r)throw new we(28);e.position=e.Ma.Va(e,t,r),e.Lb=[]}function Ze(e,t,r,n,s){if(0>n||0>s)throw new we(28);if(null===e.fd)throw new we(8);if(1==(2097155&e.flags))throw new we(8);if(ke(e.node.mode))throw new we(31);if(!e.Ma.read)throw new we(28);var o=void 0!==s;if(o){if(!e.seekable)throw new we(70)}else s=e.position;return t=e.Ma.read(e,t,r,n,s),o||(e.position+=t),t}function et(e,t,r,n,s){if(0>n||0>s)throw new we(28);if(null===e.fd)throw new we(8);if(!(2097155&e.flags))throw new we(8);if(ke(e.node.mode))throw new we(31);if(!e.Ma.write)throw new we(28);e.seekable&&1024&e.flags&&Je(e,0,2);var o=void 0!==s;if(o){if(!e.seekable)throw new we(70)}else s=e.position;return t=e.Ma.write(e,t,r,n,s,void 0),o||(e.position+=t),t}function tt(e,t,r){e=Y("/dev/"+e);var n=de(!!t,!!r);tt.yb??(tt.yb=64);var s=tt.yb++<<8;Ne(s,{open(e){e.seekable=!1},close(){r?.buffer?.length&&r(10)},read(e,r,n,s){for(var o=0,a=0;a<s;a++){try{var i=t()}catch(e){throw new we(29)}if(void 0===i&&0===o)throw new we(6);if(null==i)break;o++,r[n+a]=i}return o&&(e.node.atime=Date.now()),o},write(e,t,n,s){for(var o=0;o<s;o++)try{r(t[n+o])}catch(e){throw new we(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),o}}),$e(e,n,s)}function rt(e,t,r){if("/"===t.charAt(0))return t;if(e=-100===e?"/":Ce(e).path,0==t.length){if(!r)throw new we(44);return e}return e+"/"+t}function nt(e,t){D[e>>2]=t.dev,D[e+4>>2]=t.mode,T[e+8>>2]=t.nlink,D[e+12>>2]=t.uid,D[e+16>>2]=t.gid,D[e+20>>2]=t.rdev,k[e+24>>3]=BigInt(t.size),D[e+32>>2]=4096,D[e+36>>2]=t.blocks;var r=t.atime.getTime(),n=t.mtime.getTime(),s=t.ctime.getTime();return k[e+40>>3]=BigInt(Math.floor(r/1e3)),T[e+48>>2]=r%1e3*1e6,k[e+56>>3]=BigInt(Math.floor(n/1e3)),T[e+64>>2]=n%1e3*1e6,k[e+72>>3]=BigInt(Math.floor(s/1e3)),T[e+80>>2]=s%1e3*1e6,k[e+88>>3]=BigInt(t.ino),0}var st,ot,at,it=void 0,lt=()=>{var e=D[+it>>2];return it+=4,e},ct=0,dt=[0,31,60,91,121,152,182,213,244,274,305,335],ut=[0,31,59,90,120,151,181,212,243,273,304,334],ht={},ft=e=>{v=e,G||0<ct||(o.onExit?.(e),A=!0),b(e,new N(e))},gt={},bt=()=>{if(!st){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:g||"./this.program"};for(e in gt)void 0===gt[e]?delete t[e]:t[e]=gt[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);st=r}return st},mt=e=>{var t=te(e)+1,r=Rt(t);return re(e,x,r,t),r},pt=0,yt=(e,t)=>(t=1==t?Rt(e.length):_t(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),x.set(e,t),t),wt=[],Et=e=>{ot.delete(at.get(e)),at.set(e,null),wt.push(e)},vt=(e,t)=>{if(!ot){ot=new WeakMap;var r=at.length;if(ot)for(var n=0;n<0+r;n++){var s=at.get(n);s&&ot.set(s,n)}}if(r=ot.get(e)||0)return r;if(wt.length)r=wt.pop();else{try{at.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}r=at.length-1}try{at.set(r,e)}catch(l){if(!(l instanceof TypeError))throw l;if("function"==typeof WebAssembly.Function){var o=WebAssembly.Function;n={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},s={parameters:[],results:"v"==t[0]?[]:[n[t[0]]]};for(var a=1;a<t.length;++a)s.parameters.push(n[t[a]]);t=new o(s,e)}else{n=[1],s=t.slice(0,1),t=t.slice(1),a={i:127,p:127,j:126,f:125,d:124,e:111},n.push(96);var i=t.length;for(o of(128>i?n.push(i):n.push(i%128|128,i>>7),t))n.push(a[o]);"v"==s?n.push(0):n.push(1,a[s]),t=[0,97,115,109,1,0,0,0,1],128>(o=n.length)?t.push(o):t.push(o%128|128,o>>7),t.push(...n),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}at.set(r,t)}return ot.set(e,r),r};be=Array(4096),Le(ce,"/"),Ve("/tmp"),Ve("/home"),Ve("/home/web_user"),function(){Ve("/dev"),Ne(259,{read:()=>0,write:(e,t,r,n)=>n,Va:()=>0}),$e("/dev/null",259),oe(1280,ie),oe(1536,le),$e("/dev/tty",1280),$e("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,r=()=>(0===t&&(Z(e),t=e.byteLength),e[--t]);tt("random",r),tt("urandom",r),Ve("/dev/shm"),Ve("/dev/shm/tmp")}(),function(){Ve("/proc");var e=Ve("/proc/self");Ve("/proc/self/fd"),Le({Xa(){var t=qe(e,"fd",16895,73);return t.Ma={Va:ce.Ma.Va},t.La={lookup(e,t){var r=Ce(e=+t);return(e={parent:null,Xa:{zb:"fake"},La:{readlink:()=>r.path},id:e+1}).parent=e},readdir:()=>Array.from(fe.entries()).filter(([,e])=>e).map(([e])=>e.toString())},t}},"/proc/self/fd")}(),ce.vb=new we(44),ce.vb.stack="<generic error, no stack>";var It,xt={a:(e,t,r,n)=>U(`Assertion failed: ${e?W(x,e):""}, at: `+[t?t?W(x,t):"":"unknown filename",r,n?n?W(x,n):"":"unknown function"]),i:function(e,t){try{return Qe(e=e?W(x,e):"",t),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},L:function(e,t,r){try{if(t=rt(e,t=t?W(x,t):""),-8&r)return-28;var n=Ie(t,{$a:!0}).node;return n?(e="",4&r&&(e+="r"),2&r&&(e+="w"),1&r&&(e+="x"),e&&je(n,e)?-2:0):-44}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},j:function(e,t){try{var r=Ce(e);return We(r,r.node,t,!1),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},h:function(e){try{var t=Ce(e);return Oe(t,t.node,{timestamp:Date.now(),Fb:!1}),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},b:function(e,t,r){it=r;try{var n=Ce(e);switch(t){case 0:var s=lt();if(0>s)break;for(;fe[s];)s++;return function(e,t=-1){return e=Se(e,t),e.Ma?.Rb?.(e),e}(n,s).fd;case 1:case 2:case 13:case 14:return 0;case 3:return n.flags;case 4:return s=lt(),n.flags|=s,0;case 12:return s=lt(),_[s+0>>1]=2,0}return-28}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},g:function(e,t){try{var r=Ce(e),n=r.node,s=r.Ma.Ta;return e=s?r:n,s??=n.La.Ta,Me(s),nt(t,s(e))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},H:function(e,t){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var r=Ce(e);if(0>t||!(2097155&r.flags))throw new we(28);return Xe(r,r.node,t),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},G:function(e,t){try{if(0===t)return-28;var r=te("/")+1;return t<r?-68:(re("/",x,e,t),r)}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},K:function(e,t){try{return nt(t,ze(e=e?W(x,e):"",!0))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},C:function(e,t,r){try{return Ve(t=rt(e,t=t?W(x,t):""),r),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},J:function(e,t,r,n){try{t=t?W(x,t):"";var s=256&n;return t=rt(e,t,4096&n),nt(r,s?ze(t,!0):ze(t))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},x:function(e,t,r,n){it=n;try{return Ye(t=rt(e,t=t?W(x,t):""),r,n?lt():0).fd}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},v:function(e,t,r,n){try{if(t=rt(e,t=t?W(x,t):""),0>=n)return-28;var s=Ie(t).node;if(!s)throw new we(44);if(!s.La.readlink)throw new we(28);var o=s.La.readlink(s),a=Math.min(n,te(o)),i=I[r+a];return re(o,x,r,n+1),I[r+a]=i,a}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},u:function(e){try{return Ge(e=e?W(x,e):""),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},f:function(e,t){try{return nt(t,ze(e=e?W(x,e):""))}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},r:function(e,t,r){try{return t=rt(e,t=t?W(x,t):""),0===r?Be(t):512===r?Ge(t):U("Invalid flags passed to unlinkat"),0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},q:function(e,t,r){try{t=rt(e,t=t?W(x,t):"",!0);var n,s,o=Date.now();if(r){var a=T[r>>2]+4294967296*D[r+4>>2],i=D[r+8>>2];n=1073741823==i?o:1073741822==i?null:1e3*a+i/1e6,a=T[(r+=16)>>2]+4294967296*D[r+4>>2],s=1073741823==(i=D[r+8>>2])?o:1073741822==i?null:1e3*a+i/1e6}else s=n=o;if(null!==(s??n)){e=n;var l=Ie(t,{$a:!0}).node;Me(l.La.Ua)(l,{atime:e,mtime:s})}return 0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},m:()=>U(""),l:()=>{G=!1,ct=0},A:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),e=new Date(1e3*e),D[t>>2]=e.getSeconds(),D[t+4>>2]=e.getMinutes(),D[t+8>>2]=e.getHours(),D[t+12>>2]=e.getDate(),D[t+16>>2]=e.getMonth(),D[t+20>>2]=e.getFullYear()-1900,D[t+24>>2]=e.getDay();var r=e.getFullYear();D[t+28>>2]=(0!=r%4||0==r%100&&0!=r%400?ut:dt)[e.getMonth()]+e.getDate()-1|0,D[t+36>>2]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var n=new Date(e.getFullYear(),0,1).getTimezoneOffset();D[t+32>>2]=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r))},y:function(e,t,r,n,s,o,a){s=-9007199254740992>s||9007199254740992<s?NaN:Number(s);try{if(isNaN(s))return 61;var i=Ce(n);if(2&t&&!(2&r)&&2!=(2097155&i.flags))throw new we(2);if(1==(2097155&i.flags))throw new we(2);if(!i.Ma.ib)throw new we(43);if(!e)throw new we(28);var l=i.Ma.ib(i,e,s,t,r),c=l.Kb;return D[o>>2]=l.Ab,T[a>>2]=c,0}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},z:function(e,t,r,n,s,o){o=-9007199254740992>o||9007199254740992<o?NaN:Number(o);try{var a=Ce(s);if(2&r){if(r=o,32768!=(61440&a.node.mode))throw new we(43);if(!(2&n)){var i=x.slice(e,e+t);a.Ma.jb&&a.Ma.jb(a,i,r,t,n)}}}catch(e){if("ErrnoError"!==e.name)throw e;return-e.Pa}},n:(e,t)=>{if(ht[e]&&(clearTimeout(ht[e].id),delete ht[e]),!t)return 0;var r=setTimeout(()=>{delete ht[e],(e=>{if(!A)try{if(e(),!(G||0<ct))try{v=e=v,ft(e)}catch(e){e instanceof N||"unwind"==e||b(1,e)}}catch(e){e instanceof N||"unwind"==e||b(1,e)}})(()=>qt(e,performance.now()))},t);return ht[e]={id:r,Xb:t},0},B:(e,t,r,n)=>{var s=(new Date).getFullYear(),o=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset(),T[e>>2]=60*Math.max(o,s),D[t>>2]=Number(o!=s),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(o),t=t(s),s<o?(re(e,x,r,17),re(t,x,n,17)):(re(e,x,n,17),re(t,x,r,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=x.length;if(2147483648<(e>>>=0))return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);e:{n=(Math.min(2147483648,65536*Math.ceil(Math.max(e,n)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow(n),M();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1},E:(e,t)=>{var r=0;return bt().forEach((n,s)=>{var o=t+r;for(s=T[e+4*s>>2]=o,o=0;o<n.length;++o)I[s++]=n.charCodeAt(o);I[s]=0,r+=n.length+1}),0},F:(e,t)=>{var r=bt();T[e>>2]=r.length;var n=0;return r.forEach(e=>n+=e.length+1),T[t>>2]=n,0},e:function(e){try{return Ke(Ce(e)),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},p:function(e,t){try{var r=Ce(e);return I[t]=r.tty?2:ke(r.mode)?3:40960==(61440&r.mode)?7:4,_[t+2>>1]=0,k[t+8>>3]=BigInt(0),k[t+16>>3]=BigInt(0),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},w:function(e,t,r,n){try{e:{var s=Ce(e);e=t;for(var o,a=t=0;a<r;a++){var i=T[e>>2],l=T[e+4>>2];e+=8;var c=Ze(s,I,i,l,o);if(0>c){var d=-1;break e}if(t+=c,c<l)break;void 0!==o&&(o+=c)}d=t}return T[n>>2]=d,0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},D:function(e,t,r,n){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var s=Ce(e);return Je(s,t,r),k[n>>3]=BigInt(s.position),s.ob&&0===t&&0===r&&(s.ob=null),0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},I:function(e){try{var t=Ce(e);return t.Ma?.fsync?t.Ma.fsync(t):0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},t:function(e,t,r,n){try{e:{var s=Ce(e);e=t;for(var o,a=t=0;a<r;a++){var i=T[e>>2],l=T[e+4>>2];e+=8;var c=et(s,I,i,l,o);if(0>c){var d=-1;break e}if(t+=c,c<l)break;void 0!==o&&(o+=c)}d=t}return T[n>>2]=d,0}catch(e){if("ErrnoError"!==e.name)throw e;return e.Pa}},k:ft};!async function(){function e(e){return It=e.exports,E=It.M,M(),at=It.O,S--,o.monitorRunDependencies?.(S),0==S&&O&&(e=O,O=null,e()),It}S++,o.monitorRunDependencies?.(S);var t={a:xt};o.instantiateWasm?new Promise(r=>{o.instantiateWasm(t,(t,n)=>{e(t),r(t.exports)})}):(C??=o.locateFile?o.locateFile("sql-wasm.wasm",m):m+"sql-wasm.wasm",e((await async function(e){var t=C;if(!j&&"function"==typeof WebAssembly.instantiateStreaming&&!P(t)&&!d)try{var r=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(r,e)}catch(e){w(`wasm streaming compile failed: ${e}`),w("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await async function(e){if(!j)try{var t=await u(e);return new Uint8Array(t)}catch{}if(e==C&&j)e=new Uint8Array(j);else{if(!h)throw"both async and sync fetching of the wasm failed";e=h(e)}return e}(e);return await WebAssembly.instantiate(r,t)}catch(e){w(`failed to asynchronously prepare wasm: ${e}`),U(e)}}(t,e)}(t)).instance))}(),o._sqlite3_free=e=>(o._sqlite3_free=It.P)(e),o._sqlite3_value_text=e=>(o._sqlite3_value_text=It.Q)(e),o._sqlite3_prepare_v2=(e,t,r,n,s)=>(o._sqlite3_prepare_v2=It.R)(e,t,r,n,s),o._sqlite3_step=e=>(o._sqlite3_step=It.S)(e),o._sqlite3_reset=e=>(o._sqlite3_reset=It.T)(e),o._sqlite3_exec=(e,t,r,n,s)=>(o._sqlite3_exec=It.U)(e,t,r,n,s),o._sqlite3_finalize=e=>(o._sqlite3_finalize=It.V)(e),o._sqlite3_column_name=(e,t)=>(o._sqlite3_column_name=It.W)(e,t),o._sqlite3_column_text=(e,t)=>(o._sqlite3_column_text=It.X)(e,t),o._sqlite3_column_type=(e,t)=>(o._sqlite3_column_type=It.Y)(e,t),o._sqlite3_errmsg=e=>(o._sqlite3_errmsg=It.Z)(e),o._sqlite3_clear_bindings=e=>(o._sqlite3_clear_bindings=It._)(e),o._sqlite3_value_blob=e=>(o._sqlite3_value_blob=It.$)(e),o._sqlite3_value_bytes=e=>(o._sqlite3_value_bytes=It.aa)(e),o._sqlite3_value_double=e=>(o._sqlite3_value_double=It.ba)(e),o._sqlite3_value_int=e=>(o._sqlite3_value_int=It.ca)(e),o._sqlite3_value_type=e=>(o._sqlite3_value_type=It.da)(e),o._sqlite3_result_blob=(e,t,r,n)=>(o._sqlite3_result_blob=It.ea)(e,t,r,n),o._sqlite3_result_double=(e,t)=>(o._sqlite3_result_double=It.fa)(e,t),o._sqlite3_result_error=(e,t,r)=>(o._sqlite3_result_error=It.ga)(e,t,r),o._sqlite3_result_int=(e,t)=>(o._sqlite3_result_int=It.ha)(e,t),o._sqlite3_result_int64=(e,t)=>(o._sqlite3_result_int64=It.ia)(e,t),o._sqlite3_result_null=e=>(o._sqlite3_result_null=It.ja)(e),o._sqlite3_result_text=(e,t,r,n)=>(o._sqlite3_result_text=It.ka)(e,t,r,n),o._sqlite3_aggregate_context=(e,t)=>(o._sqlite3_aggregate_context=It.la)(e,t),o._sqlite3_column_count=e=>(o._sqlite3_column_count=It.ma)(e),o._sqlite3_data_count=e=>(o._sqlite3_data_count=It.na)(e),o._sqlite3_column_blob=(e,t)=>(o._sqlite3_column_blob=It.oa)(e,t),o._sqlite3_column_bytes=(e,t)=>(o._sqlite3_column_bytes=It.pa)(e,t),o._sqlite3_column_double=(e,t)=>(o._sqlite3_column_double=It.qa)(e,t),o._sqlite3_bind_blob=(e,t,r,n,s)=>(o._sqlite3_bind_blob=It.ra)(e,t,r,n,s),o._sqlite3_bind_double=(e,t,r)=>(o._sqlite3_bind_double=It.sa)(e,t,r),o._sqlite3_bind_int=(e,t,r)=>(o._sqlite3_bind_int=It.ta)(e,t,r),o._sqlite3_bind_text=(e,t,r,n,s)=>(o._sqlite3_bind_text=It.ua)(e,t,r,n,s),o._sqlite3_bind_parameter_index=(e,t)=>(o._sqlite3_bind_parameter_index=It.va)(e,t),o._sqlite3_sql=e=>(o._sqlite3_sql=It.wa)(e),o._sqlite3_normalized_sql=e=>(o._sqlite3_normalized_sql=It.xa)(e),o._sqlite3_changes=e=>(o._sqlite3_changes=It.ya)(e),o._sqlite3_close_v2=e=>(o._sqlite3_close_v2=It.za)(e),o._sqlite3_create_function_v2=(e,t,r,n,s,a,i,l,c)=>(o._sqlite3_create_function_v2=It.Aa)(e,t,r,n,s,a,i,l,c),o._sqlite3_update_hook=(e,t,r)=>(o._sqlite3_update_hook=It.Ba)(e,t,r),o._sqlite3_open=(e,t)=>(o._sqlite3_open=It.Ca)(e,t);var _t=o._malloc=e=>(_t=o._malloc=It.Da)(e),Dt=o._free=e=>(Dt=o._free=It.Ea)(e);o._RegisterExtensionFunctions=e=>(o._RegisterExtensionFunctions=It.Fa)(e);var Tt=(e,t)=>(Tt=It.Ga)(e,t),qt=(e,t)=>(qt=It.Ha)(e,t),kt=e=>(kt=It.Ia)(e),Rt=e=>(Rt=It.Ja)(e),jt=()=>(jt=It.Ka)();if(o.stackSave=()=>jt(),o.stackRestore=e=>kt(e),o.stackAlloc=e=>Rt(e),o.cwrap=(e,t,r,n)=>{var s=!r||r.every(e=>"number"===e||"boolean"===e);return"string"!==t&&s&&!n?o["_"+e]:(...n)=>((e,t,r,n)=>{var s={string:e=>{var t=0;return null!=e&&0!==e&&(t=mt(e)),t},array:e=>{var t=Rt(e.length);return I.set(e,t),t}};e=o["_"+e];var a,i=[],l=0;if(n)for(var c=0;c<n.length;c++){var d=s[r[c]];d?(0===l&&(l=jt()),i[c]=d(n[c])):i[c]=n[c]}return a=r=e(...i),0!==l&&kt(l),"string"===t?a?W(x,a):"":"boolean"===t?!!a:a})(e,t,r,n)},o.addFunction=vt,o.removeFunction=Et,o.UTF8ToString=Q,o.ALLOC_NORMAL=pt,o.allocate=yt,o.allocateUTF8OnStack=mt,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return function e(){function t(){if(o.calledRun=!0,!A){var e,t;if(o.noFSInit||me||(me=!0,r??=o.stdin,e??=o.stdout,t??=o.stderr,r?tt("stdin",r):He("/dev/tty","/dev/stdin"),e?tt("stdout",null,e):He("/dev/tty","/dev/stdout"),t?tt("stderr",null,t):He("/dev/tty1","/dev/stderr"),Ye("/dev/stdin",0),Ye("/dev/stdout",1),Ye("/dev/stderr",1)),It.N(),pe=!1,o.onRuntimeInitialized?.(),o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;){var r=o.postRun.shift();F.unshift(r)}L(F)}}if(0<S)O=e;else{if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)$();L(V),0<S?O=e:o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),t()},1)):t()}}(),a}))};e.exports=s,e.exports.default=s},895:e=>{"use strict";e.exports=require("chalk")},941:function(e,t,r){"use strict";var n,s=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),a=0;a<r.length;a++)"default"!==r[a]&&s(t,e,r[a]);return o(t,e),t}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseManager=void 0;const l=a(r(383)),c=a(r(3)),d=i(r(826)),u=r(895),h=r(599),f=new u.Chalk,g="[ValueTracker-DatabaseManager]";t.DatabaseManager=class{constructor(e,t){if(!t)throw console.error(f.red(g),"Extension ID is required for per-extension database"),new Error("Extension ID is required for per-extension database");if("string"!=typeof t)throw console.error(f.red(g),"Extension ID must be a string, got "+typeof t),new Error("Extension ID must be a string, got "+typeof t);if(this.extensionId=(0,h.validateExtensionId)(t),console.log(f.blue(g),"Creating DatabaseManager for extension:",this.extensionId),e&&console.warn(f.yellow(g),"dbPath argument ignored for security. Database will be created in default location."),!this.extensionId)throw console.error(f.red(g),"Extension ID is empty after validation, cannot create database path"),new Error("Extension ID is empty after validation");if(this.dbPath=c.join(process.cwd(),"db",`${this.extensionId}.db`),console.log(f.blue(g),"Database path:",this.dbPath),"string"!=typeof this.dbPath||!this.dbPath)throw console.error(f.red(g),"Database path is not a valid string:",this.dbPath),new Error("Database path is not a valid string");const r=c.dirname(this.dbPath);this.ensureDirectoryExists(r),console.log(f.blue(g),"Ensured database directory exists:",r);try{const e=(0,d.default)({locateFile:e=>`https://sql.js.org/dist/${e}`});let t,r;l.existsSync(this.dbPath)&&(t=l.readFileSync(this.dbPath)),t&&(r=new Uint8Array(t)),this.db=new e.Database(r)}catch(e){throw console.error(f.red(g),"Failed to create or load database:",e),e}console.log(f.blue(g),"Database connection established"),this.initializeTables(),console.log(f.green(g),"Database tables initialized for extension:",this.extensionId)}getExtensionId(){return this.extensionId}getDbPath(){return this.dbPath}isOpen(){return void 0!==this.db}upsertCharacter(e){if(!this.isOpen())throw console.error(f.red(g),"Database is closed for extension:",this.extensionId),new Error("Database is closed");if(!e.id)throw console.error(f.red(g),"Character ID is required for extension:",this.extensionId),new Error("Character ID is required");console.log(f.blue(g),"Upserting character:",e.id,"for extension:",this.extensionId);const t=(new Date).toISOString(),r=this.getCharacter(e.id);try{r?(console.log(f.blue(g),"Updating existing character:",e.id),this.db.run("\n                    UPDATE characters\n                    SET name       = COALESCE(?, name),\n                        updated_at = ?\n                    WHERE id = ?\n                ",[e.name||null,t,e.id])):(console.log(f.blue(g),"Inserting new character:",e.id),this.db.run("\n                    INSERT INTO characters (id, name, created_at, updated_at)\n                    VALUES (?, ?, ?, ?)\n                ",[e.id,e.name||null,t,t]));const n=this.getCharacter(e.id);return console.log(f.green(g),"Character upserted successfully:",e.id,"for extension:",this.extensionId),n}catch(t){throw console.error(f.red(g),"Error upserting character",e.id,"for extension",this.extensionId+":",t),t}}getCharacter(e){const t=this.db.prepare("SELECT id, name, created_at as createdAt, updated_at as updatedAt FROM characters WHERE id = ?"),r=t.get([e]);return t.free(),r?{id:r[0],name:r[1],createdAt:new Date(r[2]),updatedAt:new Date(r[3])}:null}getAllCharacters(){const e=this.db.prepare("SELECT id, name, created_at as createdAt, updated_at as updatedAt FROM characters"),t=e.all();return e.free(),t.map(e=>({id:e[0],name:e[1],createdAt:new Date(e[2]),updatedAt:new Date(e[3])}))}deleteCharacter(e){if(!e)throw console.error(f.red(g),"Character ID is required for extension:",this.extensionId),new Error("Character ID is required");if(console.log(f.blue(g),"Deleting character:",e,"for extension:",this.extensionId),!this.getCharacter(e))return console.log(f.yellow(g),"Character not found for deletion:",e,"for extension:",this.extensionId),!1;try{const t=this.getInstancesByCharacter(e);console.log(f.blue(g),"Found",t.length,"instances for character",e,"to be deleted");for(const e of t)console.log(f.blue(g),"Deleting data for instance:",e.id),this.db.run("DELETE FROM data WHERE instance_id = ?",[e.id]);return console.log(f.blue(g),"Deleting instances for character:",e),this.db.run("DELETE FROM instances WHERE character_id = ?",[e]),console.log(f.blue(g),"Deleting character:",e),this.db.run("DELETE FROM characters WHERE id = ?",[e]),console.log(f.green(g),"Character deleted successfully:",e,"for extension:",this.extensionId),!0}catch(t){throw console.error(f.red(g),"Error deleting character",e,"for extension",this.extensionId+":",t),t}}upsertInstance(e){if(!this.isOpen())throw new Error("Database is closed");if(!e.id||!e.characterId)throw new Error("Instance ID and character ID are required");try{const t=(new Date).toISOString();return this.getInstance(e.id)?this.db.run("\n            UPDATE instances\n            SET name = COALESCE(?, name),\n                character_id = COALESCE(?, character_id),\n                updated_at = ?\n            WHERE id = ?\n          ",[e.name||null,e.characterId,t,e.id]):this.db.run("\n            INSERT INTO instances (id, character_id, name, created_at, updated_at)\n            VALUES (?, ?, ?, ?, ?)\n          ",[e.id,e.characterId,e.name||null,t,t]),this.getInstance(e.id)}catch(t){throw console.error(`[DatabaseManager] Error upserting instance ${e.id}:`,t),t}}getInstance(e){const t=this.db.prepare("SELECT id, character_id as characterId, name, created_at as createdAt, updated_at as updatedAt FROM instances WHERE id = ?"),r=t.get([e]);return t.free(),r?{id:r[0],characterId:r[1],name:r[2],createdAt:new Date(r[3]),updatedAt:new Date(r[4])}:null}getInstancesByCharacter(e){const t=this.db.prepare("SELECT id, character_id as characterId, name, created_at as createdAt, updated_at as updatedAt FROM instances WHERE character_id = ?"),r=t.all();return t.free(),r.map(e=>({id:e[0],characterId:e[1],name:e[2],createdAt:new Date(e[3]),updatedAt:new Date(e[4])}))}deleteInstance(e){if(!e)throw new Error("Instance ID is required");if(!this.getInstance(e))return!1;try{return this.db.run("DELETE FROM data WHERE instance_id = ?",[e]),this.db.run("DELETE FROM instances WHERE id = ?",[e]),!0}catch(t){throw console.error(`[DatabaseManager] Error deleting instance ${e}:`,t),t}}upsertData(e,t,r){if(!this.isOpen())throw console.error(f.red(g),"Database is closed for extension:",this.extensionId),new Error("Database is closed");if(!e||!t)throw console.error(f.red(g),"Instance ID and key are required for extension:",this.extensionId),new Error("Instance ID and key are required");console.log(f.blue(g),"Upserting data for instance:",e,"key:",t,"value:",r,"for extension:",this.extensionId);try{const n=(new Date).toISOString(),s="object"==typeof r?JSON.stringify(r):String(r);this.db.run("\n          INSERT OR REPLACE INTO data (instance_id, key, value, updated_at)\n          VALUES (?, ?, ?, ?)\n        ",[e,t,s,n]),console.log(f.green(g),"Data upserted successfully for instance:",e,"key:",t,"for extension:",this.extensionId)}catch(r){throw console.error(f.red(g),"Error upserting data for instance",e,"key",t,"for extension",this.extensionId+":",r),r}}getData(e){const t=this.db.prepare("SELECT key, value FROM data WHERE instance_id = ?"),r=t.all();t.free();const n={};for(const e of r){const t=e[0],r=e[1];try{n[t]=JSON.parse(r)}catch(e){n[t]=r}}return n}getDataValue(e,t){if(!e||!t)throw new Error("Instance ID and key are required");try{const r=this.db.prepare("SELECT value FROM data WHERE instance_id = ? AND key = ?"),n=r.get([e,t]);if(r.free(),!n||0===n.length)return;const s=n[0];try{return JSON.parse(s)}catch(e){return s}}catch(r){throw console.error(`[DatabaseManager] Error getting data value for instance ${e}, key ${t}:`,r),r}}deleteDataValue(e,t){if(!e||!t)throw new Error("Instance ID and key are required");if(void 0===this.getDataValue(e,t))return!1;try{return this.db.run("DELETE FROM data WHERE instance_id = ? AND key = ?",[e,t]),!0}catch(r){throw console.error(`[DatabaseManager] Error deleting data value for instance ${e}, key ${t}:`,r),r}}getFullCharacter(e){const t=this.getCharacter(e);return t?{character:t,instances:this.getInstancesByCharacter(e).map(e=>({instance:e,data:this.getData(e.id)}))}:null}getFullInstance(e){const t=this.getInstance(e);return t?{instance:t,data:this.getData(e)}:null}clearInstanceData(e){if(!e)throw new Error("Instance ID is required");const t=this.getData(e);if(0===Object.keys(t).length)return!1;try{return this.db.run("DELETE FROM data WHERE instance_id = ?",[e]),!0}catch(t){throw console.error(`[DatabaseManager] Error clearing data for instance ${e}:`,t),t}}close(){console.log(f.yellow(g),"Closing database connection for extension:",this.extensionId);try{const e=this.db.export();l.writeFileSync(this.dbPath,e),this.db.close(),console.log(f.green(g),"Database connection closed successfully for extension:",this.extensionId)}catch(e){console.error(f.red(g),"Error closing database connection for extension",this.extensionId+":",e)}}ensureDirectoryExists(e){l.existsSync(e)||l.mkdirSync(e,{recursive:!0})}initializeTables(){console.log(f.blue(g),"Initializing database tables for extension:",this.extensionId),console.log(f.blue(g),"Creating characters table for extension:",this.extensionId),this.db.run("\n      CREATE TABLE IF NOT EXISTS characters (\n        id TEXT PRIMARY KEY,\n        name TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )\n    "),console.log(f.blue(g),"Creating instances table for extension:",this.extensionId),this.db.run("\n      CREATE TABLE IF NOT EXISTS instances (\n        id TEXT PRIMARY KEY,\n        character_id TEXT NOT NULL,\n        name TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (character_id) REFERENCES characters (id)\n      )\n    "),console.log(f.blue(g),"Creating data table for extension:",this.extensionId),this.db.run("\n      CREATE TABLE IF NOT EXISTS data (\n        instance_id TEXT NOT NULL,\n        key TEXT NOT NULL,\n        value TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        PRIMARY KEY (instance_id, key),\n        FOREIGN KEY (instance_id) REFERENCES instances (id)\n      )\n    "),console.log(f.blue(g),"Creating indexes for extension:",this.extensionId),this.db.run("CREATE INDEX IF NOT EXISTS idx_instances_character_id ON instances(character_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_data_instance_id ON data(instance_id)"),console.log(f.green(g),"Database tables initialized successfully for extension:",this.extensionId)}}},958:(e,t)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.setCrossExtensionReader=function(e){r=e},t.getCrossExtensionReader=function(){if(!r)throw new Error("CrossExtensionReader not initialized. Call setCrossExtensionReader first.");return r}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n=r(156);module.exports=n})();